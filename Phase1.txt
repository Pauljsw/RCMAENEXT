# ğŸ”¥ Phase 1: Teacher-Student Architecture ì‹¤í–‰ ê°€ì´ë“œ

## ğŸ“ ìƒˆë¡œ ìƒì„±ëœ íŒŒì¼ë“¤

### 1. **Core Implementation Files**
```
pcdet/models/backbones_3d/rmae_cmae_backbone_phase1.py     # Teacher-Student Backbone
pcdet/models/detectors/rmae_cmae_detector_phase1.py        # Teacher-Student Detector  
tools/train_rmae_cmae_phase1.py                            # Phase 1 Training Script
tools/train_utils/optimization/differential_lr.py          # ì°¨ë“± í•™ìŠµë¥  êµ¬í˜„
```

### 2. **Configuration Files**
```
cfgs/custom_models/rmae_cmae_isarc_4class_pretraining_phase1.yaml    # Pretraining ì„¤ì •
cfgs/custom_models/rmae_cmae_isarc_4class_finetune_phase1.yaml       # Fine-tuning ì„¤ì •
```

### 3. **Updated Registry Files**
```
pcdet/models/backbones_3d/__init__.py    # RMAECMAEBackbonePhase1 ë“±ë¡
pcdet/models/detectors/__init__.py       # RMAECMAEDetectorPhase1 ë“±ë¡
```

---

## ğŸš€ ì‹¤í–‰ ëª…ë ¹ì–´

### **Stage 1: Pretraining (Self-supervised Learning)**
```bash
python tools/train_rmae_cmae_phase1.py \
    --cfg_file cfgs/custom_models/rmae_cmae_isarc_4class_pretraining_phase1.yaml \
    --batch_size 8 \
    --epochs 30 \
    --extra_tag rmae_cmae_pretraining_phase1
```

### **Stage 2: Fine-tuning (Supervised Detection)**  
```bash
bash scripts/dist_train.sh 1 \
    --cfg_file cfgs/custom_models/rmae_cmae_isarc_4class_finetune_phase1.yaml \
    --pretrained_model /home/sungwoo/VoxelNeXt/output/custom_models/rmae_cmae_isarc_4class_pretraining_phase1/rmae_cmae_pretraining_phase1/ckpt/checkpoint_epoch_30.pth \
    --batch_size 8 \
    --extra_tag rmae_cmae_finetune_phase1
```

---

## ğŸ“Š ì½”ë“œ ì‹¤í–‰ íë¦„

### **Pretraining ì‹¤í–‰ íë¦„:**
```
train_rmae_cmae_phase1.py
    â†“
parse_config() â†’ ì„¤ì • íŒŒì¼ ë¡œë“œ
    â†“
build_dataloader() â†’ ë°ì´í„°ì…‹ êµ¬ì¶•  
    â†“
build_network() â†’ RMAECMAEDetectorPhase1 ìƒì„±
    â†“ 
RMAECMAEDetectorPhase1.__init__()
    â†“
build_networks() â†’ RMAECMAEBackbonePhase1 ìƒì„±
    â†“
train_model_phase1() â†’ í›ˆë ¨ ë£¨í”„ ì‹œì‘
    â†“
train_one_epoch_phase1()
    â†“
model_func(model, batch_dict)
    â†“
RMAECMAEDetectorPhase1.forward()
    â†“
RMAECMAEBackbonePhase1.forward()
    â†“
teacher_forward() + student_forward() (if training & teacher_student enabled)
    â†“ 
get_training_loss()
    â†“
_get_rmae_loss() (í˜„ì¬ í™œì„±í™”) + _get_teacher_student_loss() (Phase 1ì—ì„œëŠ” ë¹„í™œì„±í™”)
```

### **Fine-tuning ì‹¤í–‰ íë¦„:**  
```
scripts/dist_train.sh â†’ tools/train.py
    â†“
build_network() â†’ RMAECMAEDetectorPhase1 (ENABLE_TEACHER_STUDENT=False)
    â†“
load_params_from_file() â†’ Pretrained weights ë¡œë“œ
    â†“
create_optimizer_with_differential_lr() â†’ ì°¨ë“± í•™ìŠµë¥  ì ìš©
    â†“
train_one_epoch()
    â†“
RMAECMAEDetectorPhase1.forward() (detection ëª¨ë“œ)
    â†“
_get_detection_loss() â†’ Classification + Regression loss
```

---

## ğŸ”§ í•µì‹¬ ê¸°ëŠ¥

### **Phase 1ì—ì„œ êµ¬í˜„ëœ ê¸°ëŠ¥:**

1. **âœ… Teacher-Student Architecture**
   - Teacher Branch: Complete voxel view ì²˜ë¦¬
   - Student Branch: Masked voxel view ì²˜ë¦¬ (ê¸°ì¡´ R-MAE ë¡œì§ í™œìš©)
   - ê¸°ì¡´ R-MAE í˜¸í™˜ì„± ì™„ì „ ìœ ì§€

2. **âœ… ì°¨ë“± í•™ìŠµë¥ **
   - Backbone: 10% LR (pretrained weights ë³´ì¡´)
   - Dense Head: 200% LR (ìƒˆë¡œìš´ task adaptation)
   - Fine-tuning ì„±ëŠ¥ ìµœì í™”

3. **âœ… ì„¤ì • í˜¸í™˜ì„±**
   - ê¸°ì¡´ R-MAE ì„¤ì • íŒŒì¼ê³¼ ì™„ì „ í˜¸í™˜
   - Teacher-Student ê¸°ëŠ¥ ON/OFF ê°€ëŠ¥
   - ì ì§„ì  í™•ì¥ì„ ìœ„í•œ êµ¬ì¡° ì¤€ë¹„

### **Phase 1ì—ì„œ ë¹„í™œì„±í™”ëœ ê¸°ëŠ¥ (Phase 2ì—ì„œ êµ¬í˜„ ì˜ˆì •):**

1. **ğŸ”„ Contrastive Learning**  
   - `TEACHER_STUDENT_WEIGHT: 0.0` (ë¹„í™œì„±í™”)
   - `_get_teacher_student_loss()` placeholderë§Œ êµ¬í˜„

2. **ğŸ”„ Multi-scale Feature Reconstruction**
   - Teacher features ì¶”ì¶œê¹Œì§€ë§Œ êµ¬í˜„
   - MLFR lossëŠ” Phase 2ì—ì„œ ì¶”ê°€ ì˜ˆì •

---

## ğŸ“ˆ ì˜ˆìƒ ê²°ê³¼

### **Phase 1 ëª©í‘œ:**
- âœ… ê¸°ì¡´ R-MAE ì„±ëŠ¥ ì™„ì „ ìœ ì§€
- âœ… Teacher-Student êµ¬ì¡° ê¸°ë°˜ ë§ˆë ¨
- âœ… ì°¨ë“± í•™ìŠµë¥ ë¡œ fine-tuning ì„±ëŠ¥ ê°œì„  (+0.5~1.0 mAP)
- âœ… Phase 2 í™•ì¥ì„ ìœ„í•œ ì•ˆì •ì ì¸ infrastructure

### **ì‹¤í—˜ ê²€ì¦ í¬ì¸íŠ¸:**
1. **í˜¸í™˜ì„± ê²€ì¦**: ê¸°ì¡´ R-MAEì™€ ë™ì¼í•œ pretraining ì„±ëŠ¥
2. **ì°¨ë“± í•™ìŠµë¥  íš¨ê³¼**: Fine-tuning ì„±ëŠ¥ ê°œì„  í™•ì¸
3. **Teacher-Student ì¤€ë¹„**: Phase 2 í™•ì¥ ê°€ëŠ¥ì„± í™•ì¸

---

## ğŸ¯ Phase 2 ì¤€ë¹„ì‚¬í•­

Phase 1ì´ ì„±ê³µì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤:

1. **Multi-scale Latent Feature Reconstruction (MLFR)** êµ¬í˜„
2. **Voxel-level Contrastive Learning** ì¶”ê°€
3. **Loss balancing** ìµœì í™”
4. **ì„±ëŠ¥ í‰ê°€** ë° hyperparameter tuning

Phase 1 ì‹¤í–‰ í›„ ê²°ê³¼ë¥¼ í™•ì¸í•´ì£¼ì‹œë©´ Phase 2ë¡œ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤!
