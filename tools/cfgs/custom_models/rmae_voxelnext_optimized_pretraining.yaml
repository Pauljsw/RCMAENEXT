# cfgs/custom_models/rmae_voxelnext_optimized_pretraining.yaml
# ìµœì í™”ëœ R-MAE VoxelNeXt Pretraining ì„¤ì •

CLASS_NAMES: ['dumptruck', 'excavator', 'grader', 'roller']

DATA_CONFIG:
    _BASE_CONFIG_: cfgs/dataset_configs/custom_dataset_isarc.yaml
    
    # âœ… ê¸°ì¡´ ì„±ê³µí•œ ë°ì´í„° ì¦ê°• ì„¤ì • ìœ ì§€
    DATA_AUGMENTOR:
        DISABLE_AUG_LIST: ['gt_sampling']
        AUG_CONFIG_LIST:
            - NAME: random_world_flip
              ALONG_AXIS_LIST: ['x']
            - NAME: random_world_scaling
              WORLD_SCALE_RANGE: [0.98, 1.02]

MODEL:
    NAME: RMAEVoxelNeXtOptimized  # ğŸš€ ìƒˆë¡œìš´ ìµœì í™”ëœ ëª¨ë¸
    
    # ===== ğŸ“Š ìµœì í™”ëœ Loss ê°€ì¤‘ì¹˜ =====
    OCCUPANCY_WEIGHT: 1.2         # 1.0 â†’ 1.2 (ë” ê°•í•œ occupancy learning)
    CONSISTENCY_WEIGHT: 0.3       # ìƒˆë¡œ ì¶”ê°€: Multi-scale consistency
    AUX_WEIGHT: 0.5              # ìƒˆë¡œ ì¶”ê°€: Auxiliary loss weight
    
    # ===== ğŸ¯ Advanced Loss ì„¤ì • =====
    USE_FOCAL_LOSS: True         # Focal loss for class imbalance
    FOCAL_LOSS_ALPHA: 0.25       # Focal loss alpha
    FOCAL_LOSS_GAMMA: 2.0        # Focal loss gamma
    OCCUPANCY_THRESHOLD: 0.5     # Occupancy threshold
    HARD_NEGATIVE_RATIO: 3.0     # Hard negative mining ratio
    
    # ===== ğŸ”„ Progressive Training ì„¤ì • =====
    PROGRESSIVE_TRAINING: True   # Progressive weight scheduling
    WARMUP_EPOCHS: 5             # Warmup epochs for progressive training
    SMOOTHING_WINDOW: 20         # Loss smoothing window
    
    VFE:
        NAME: MeanVFE

    BACKBONE_3D:
        NAME: RadialMAEVoxelNeXtOptimized  # ğŸ—ï¸ ìƒˆë¡œìš´ ìµœì í™”ëœ ë°±ë³¸
        
        # ===== ğŸ“Š ìµœì í™”ëœ Masking íŒŒë¼ë¯¸í„° =====
        MASKED_RATIO: 0.85                # 0.8 â†’ 0.85 (ë” ë†’ì€ masking)
        ANGULAR_RANGE: 5                  # 1 â†’ 5ë„ (ë” íš¨ìœ¨ì )
        
        # ===== ğŸ¯ Distance-aware Masking =====
        DISTANCE_RANGES: [0, 20, 40, 80] # Distance ranges in meters
        DISTANCE_MASK_RATIOS: [0.7, 0.8, 0.9, 0.95]  # ê·¼ê±°ë¦¬ ë‚®ì€ masking
        
        # ===== ğŸ“ˆ Dynamic Minimum Voxel =====
        MIN_VOXEL_RATIO: 0.08            # 8% minimum (ë…¼ë¬¸ ê¸°ì¤€)
        ADAPTIVE_THRESHOLD: True         # Adaptive threshold
        
        # ===== ğŸ”„ Progressive Masking =====
        PROGRESSIVE_MASKING: True        # Progressive masking ratio
        INITIAL_MASK_RATIO: 0.6          # ì´ˆê¸° ë‚®ì€ masking
        FINAL_MASK_RATIO: 0.85           # ìµœì¢… ë†’ì€ masking
        TOTAL_TRAINING_STEPS: 35000      # 35 epochs * ~1000 steps
        
        PRETRAINING: True

    # âœ… Pretraining ëª¨ë“œì—ì„œëŠ” DENSE_HEAD ì œê±°
    POST_PROCESSING:
        RECALL_THRESH_LIST: [0.3, 0.5, 0.7]
        EVAL_METRIC: kitti

OPTIMIZATION:
    # ===== ğŸš€ ìµœì í™”ëœ í•™ìŠµ ì„¤ì • =====
    BATCH_SIZE_PER_GPU: 6            # 8 â†’ 6 (ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±)
    NUM_EPOCHS: 35                   # 30 â†’ 35 (ë” ê¸´ í•™ìŠµ)

    OPTIMIZER: adam_onecycle
    LR: 0.0008                       # 0.001 â†’ 0.0008 (ë” ì•ˆì •ì )
    WEIGHT_DECAY: 0.005              # 0.01 â†’ 0.005 (less regularization)
    MOMENTUM: 0.9

    MOMS: [0.95, 0.85]
    PCT_START: 0.4
    DIV_FACTOR: 10
    DECAY_STEP_LIST: [25, 30]        # 35 epochsì— ë§ê²Œ ì¡°ì •
    LR_DECAY: 0.1
    LR_CLIP: 0.0000001

    # ===== ğŸ“ˆ ê°œì„ ëœ Warmup ì„¤ì • =====
    LR_WARMUP: True                  # Warmup í™œì„±í™”
    WARMUP_EPOCH: 3                  # ë” ê¸´ warmup
    
    GRAD_NORM_CLIP: 10

# ===== ğŸ”§ ì¶”ê°€ ìµœì í™” ì„¤ì • =====
HOOK:
    DisableAugmentationHook:
        DISABLE_AUG_LIST: ['gt_sampling']
        NUM_LAST_EPOCHS: 5           # ë§ˆì§€ë§‰ 5 epochsëŠ” augmentation ë¹„í™œì„±í™”